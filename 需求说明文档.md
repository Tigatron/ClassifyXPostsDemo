根据Chrome内置AI API和您的需求，我为您生成了以下完整的需求设计文档：[1][2]

***

# X书签智能分类插件 - 需求设计文档

**项目名称**: X Bookmark AI Classifier  
**版本**: v1.0  
**创建日期**: 2025-10-24  
**文档状态**: 草案

***

## 1. 项目概述

### 1.1 项目背景
用户在社交平台X（Twitter）上收藏了大量书签，但缺乏有效的分类和管理工具。手动分类耗时且效率低下，需要一个智能化的自动分类解决方案。

### 1.2 项目目标
开发一个Chrome浏览器插件，利用Chrome内置AI API（Summarizer API）自动提取书签内容摘要，并基于摘要进行智能分类，帮助用户高效管理X平台书签。

### 1.3 核心价值
- **自动化**: 无需手动逐条分类
- **本地化**: 使用Chrome内置AI，无需上传数据到服务器，保护隐私
- **智能化**: 基于内容语义进行分类，而非简单的关键词匹配
- **高效化**: 批量处理，一键完成所有书签分类

***

## 2. 技术架构

### 2.1 技术选型

| 组件 | 技术 | 版本要求 |
|------|------|----------|
| 浏览器平台 | Chrome | 138+ |
| AI能力 | Summarizer API | Chrome 138+ |
| 插件框架 | Chrome Extension Manifest | V3 |
| 前端框架 | 原生JavaScript | ES6+ |
| UI框架 | 原生HTML/CSS | - |
| 数据存储 | Chrome Storage API | - |

### 2.2 系统架构

```
┌─────────────────────────────────────────┐
│          Chrome Extension               │
│  ┌───────────────────────────────────┐  │
│  │        UI Layer (Popup)           │  │
│  │  - 操作按钮                        │  │
│  │  - 进度显示                        │  │
│  │  - 分类结果展示                    │  │
│  └───────────────┬───────────────────┘  │
│                  │                       │
│  ┌───────────────▼───────────────────┐  │
│  │     Business Logic Layer          │  │
│  │  - 书签提取器                      │  │
│  │  - AI摘要生成器                    │  │
│  │  - 智能分类器                      │  │
│  │  - 结果导出器                      │  │
│  └───────────────┬───────────────────┘  │
│                  │                       │
│  ┌───────────────▼───────────────────┐  │
│  │      Data Access Layer            │  │
│  │  - DOM操作                         │  │
│  │  - Chrome Storage                  │  │
│  │  - 滚动控制                        │  │
│  └───────────────────────────────────┘  │
└─────────────────┬───────────────────────┘
                  │
      ┌───────────▼───────────┐
      │   Chrome Built-in AI  │
      │   - Summarizer API    │
      │   - Gemini Nano       │
      └───────────────────────┘
```

***

## 3. 功能需求

### 3.1 核心功能模块

#### 3.1.1 书签提取模块

**功能描述**: 从X书签页面提取所有书签数据

**技术实现**:
- 使用Content Script注入到 `x.com/i/bookmarks` 页面
- 通过DOM选择器提取帖子信息
- 支持自动滚动加载全部书签

**数据结构**:
```javascript
interface Bookmark {
  url: string;           // 帖子URL
  statusId: string;      // 状态ID
  username: string;      // 发布者用户名
  displayName: string;   // 发布者显示名称
  datetime: string;      // 发布时间（ISO格式）
  text: string;          // 帖子文本内容
  hasMedia: boolean;     // 是否包含媒体
  mediaType?: string;    // 媒体类型（image/video）
}
```

**提取流程**:
```
1. 检测当前页面是否为书签页
   ├─ 是 → 继续
   └─ 否 → 提示用户导航到书签页

2. 提取当前可见书签
   └─ 使用 querySelectorAll('article') 获取帖子

3. 自动滚动加载更多
   ├─ 滚动到底部
   ├─ 等待加载（1.5秒）
   ├─ 检查是否有新内容
   │  ├─ 有 → 继续滚动
   │  └─ 无（连续3次） → 加载完成
   └─ 去重处理

4. 返回书签数组
```

#### 3.1.2 AI摘要生成模块

**功能描述**: 使用Chrome Summarizer API为每条书签生成内容摘要

**API使用**: Chrome Summarizer API[2]

**技术参数**:
```javascript
const summarizerOptions = {
  type: 'key-points',        // 提取关键点
  format: 'plain-text',      // 纯文本格式
  length: 'short',           // 短摘要（3个关键点）
  sharedContext: '这是来自X社交平台的用户收藏内容，包含多种主题如技术、金融、学习等',
  expectedInputLanguages: ['zh', 'en', 'ja'],  // 支持中英日
  outputLanguage: 'zh'       // 输出中文
};
```

**处理流程**:
```
1. 检查Summarizer API可用性
   ├─ 可用 → 继续
   ├─ 需下载模型 → 提示用户并显示下载进度
   └─ 不可用 → 降级方案（使用关键词提取）

2. 创建Summarizer实例
   └─ await Summarizer.create(options)

3. 批量生成摘要
   for each bookmark:
     ├─ 清理HTML标签（使用innerText）
     ├─ 调用 summarizer.summarize(text)
     ├─ 保存摘要结果
     └─ 更新进度显示

4. 释放资源
   └─ summarizer.destroy()
```

**错误处理**:
- 模型下载失败：提示用户检查网络和存储空间
- 摘要生成失败：使用原文前200字作为fallback
- 超时处理：单条摘要超过10秒则跳过

#### 3.1.3 智能分类模块

**功能描述**: 基于摘要内容自动将书签分类到预定义类别

**分类策略**: 两阶段分类法

**阶段一：基于关键词的初步分类**
```javascript
const categories = {
  '出海/金融': {
    keywords: ['银行', 'stripe', '港卡', '出海', 'za bank', '支付', '跨境', '汇款', '外汇'],
    weight: 1.0
  },
  '加密货币': {
    keywords: ['币', '虚拟币', '加密', 'crypto', 'btc', 'eth', 'web3', 'defi', '区块链'],
    weight: 1.0
  },
  'AI工具': {
    keywords: ['ai', 'gpt', 'llm', 'prompt', '人工智能', 'neural', 'gemini', 'claude'],
    weight: 1.0
  },
  '开发工具': {
    keywords: ['github', '工具', 'api', '开源', 'code', 'vscode', '编程'],
    weight: 1.0
  },
  '学习/教程': {
    keywords: ['学习', '教程', '课程', 'tutorial', 'learn', '书', '阅读'],
    weight: 1.0
  },
  '商业思维': {
    keywords: ['创业', '商业', 'business', '增长', '运营', '产品'],
    weight: 1.0
  },
  '投资/理财': {
    keywords: ['投资', '股票', '基金', '理财', '纪录片', '经济'],
    weight: 1.0
  }
};
```

**阶段二：基于AI摘要的语义分类**

如果关键词匹配度低于阈值(0.3)，使用AI摘要进行二次分类：
```
1. 提取摘要中的核心概念
2. 计算与各类别的语义相似度
3. 选择相似度最高的类别
4. 如果所有相似度 < 0.4 → 归入"其他"
```

**分类流程**:
```
for each bookmark with summary:
  1. 预处理：转小写、去除标点
  
  2. 关键词匹配
     score = Σ(matched_keywords * weight)
     
  3. 判断置信度
     ├─ score > 0.5 → 高置信度，直接分类
     ├─ 0.2 < score ≤ 0.5 → 中等置信度，使用摘要辅助
     └─ score ≤ 0.2 → 低置信度，基于摘要分类或归入"其他"
  
  4. 保存分类结果
     └─ bookmark.category = categoryName
```

#### 3.1.4 结果导出模块

**功能描述**: 将分类结果导出为多种格式

**支持格式**:

1. **Markdown格式**
```markdown
# X书签分类结果

生成时间: 2025-10-24 16:00:00
总计: 45条书签

## 出海/金融 (8条)

### 1. 出海必须开通的服务
**摘要**: 介绍ZA Bank、Stripe、U卡等出海服务工具
**链接**: https://x.com/sanvibyfish/status/1979469969407750253
**发布者**: @sanvibyfish
**时间**: 2025-10-18

---
```

2. **JSON格式**
```json
{
  "exportTime": "2025-10-24T16:00:00Z",
  "totalCount": 45,
  "categories": {
    "出海/金融": {
      "count": 8,
      "bookmarks": [
        {
          "title": "出海必须开通的服务",
          "summary": "介绍ZA Bank、Stripe、U卡等出海服务工具",
          "url": "https://x.com/...",
          "username": "@sanvibyfish",
          "datetime": "2025-10-18T10:00:00Z"
        }
      ]
    }
  }
}
```

3. **CSV格式**
```csv
分类,标题,摘要,链接,用户名,时间
出海/金融,出海必须开通的服务,介绍ZA Bank、Stripe、U卡等出海服务工具,https://x.com/...,@sanvibyfish,2025-10-18
```

**导出功能**:
- 复制到剪贴板
- 下载为文件
- 在新标签页中预览

***

### 3.2 辅助功能

#### 3.2.1 进度显示
- 实时显示：提取进度 / AI处理进度 / 分类进度
- 进度条可视化
- 预估剩余时间

#### 3.2.2 错误处理
- 网络错误重试机制（最多3次）
- AI API调用失败的fallback方案
- 用户友好的错误提示

#### 3.2.3 设置管理
- 自定义分类类别
- 调整AI参数（摘要类型、长度）
- 导出格式偏好设置

***

## 4. 用户界面设计

### 4.1 Popup界面

```
┌─────────────────────────────────┐
│  X 书签智能分类              [?]│
├─────────────────────────────────┤
│                                 │
│  📊 当前状态                     │
│  • 已加载书签: 0 条              │
│  • AI模型状态: 未初始化          │
│                                 │
│  ┌───────────────────────────┐  │
│  │  [▶ 开始自动分类]          │  │
│  └───────────────────────────┘  │
│                                 │
│  ┌───────────────────────────┐  │
│  │  [⚙ 设置]  [📁 查看历史]   │  │
│  └───────────────────────────┘  │
│                                 │
│  进度: ████░░░░░░░ 40%          │
│  正在处理: 提取书签内容...       │
│                                 │
├─────────────────────────────────┤
│  分类结果预览                    │
│  • 出海/金融: 8条                │
│  • AI工具: 12条                  │
│  • 开发工具: 6条                 │
│  • 学习/教程: 15条               │
│  • 其他: 4条                     │
│                                 │
│  [📋 复制]  [💾 导出]  [👀 预览] │
└─────────────────────────────────┘
```

### 4.2 设置页面

```
┌─────────────────────────────────┐
│  设置                            │
├─────────────────────────────────┤
│  AI参

[1](https://developer.chrome.com/docs/ai/built-in-apis?hl=zh-cn)
[2](https://developer.chrome.com/docs/ai/summarizer-api?hl=zh-cn)

### 3.1.5 分类展示模块（新增）

**功能描述**: 根据生成的摘要内容对帖子进行分类，并在浏览器侧边栏中展示。

**展示要求**:
- 侧边栏按分类分组展示帖子。
- 每个分类标题下展示：
  - 发帖人 ID
  - 帖子链接
  - 摘要内容（使用 Summarizer API 生成）
  - 日期

**数据结构补充**:
```javascript
interface ClassifiedBookmark extends Bookmark {
  category: string;      // 分类名称
  summary: string;       // 摘要内容
}
```

**处理流程**:
1. 获取每条帖子的摘要内容。
2. 使用智能分类模块对帖子进行分类。
3. 将分类结果渲染到浏览器侧边栏，按分类分组展示。
